$(function(){var a=$("#rule-container");chrome.storage.sync.get(null,function(e){var b=$("#itemTpl").html();var d=_.template(b);var c=d({rules:_.pairs(e)});a.find(".col-sm-3:first").after(c);var f=function(m,i,k,h,g){var l=[[i,{"title":m,"css":k,"script":h}]];var j=d({rules:l});if(g){g.replaceWith(j)}else{a.find(".col-sm-3:first").after(j)}};$("#rule-container").on("click",".delete",function(){if(confirm("确认要删除该样式规则吗？")){var h=$(this);var g=h.data("ruleurl");h.closest(".col-sm-3").remove();chrome.storage.sync.remove(g)}});$("#rule-container").on("click",".update, .add",function(){var k=$(this);var h=k.data("ruleurl")||"";var j=k.data("css")||"";var l=k.data("title")||"";var i=k.data("script")||"";j=j.replace(/\n|\r/g,"");var g=null;if(h!=""){g=k.closest(".col-sm-3")}BootstrapDialog.show({title:"规则",message:'标题: <input required type="text" class="form-control rule-title" value="'+l+'" placeholder="输入规则标题"><br/>'+'链接: <input required type="text" class="form-control rule-url" value="'+h+'" placeholder="输入包含链接,如:https://www.google.com/"><br/>'+'样式: <textarea required class="form-control rule-css" style="min-height: 100px" placeholder="输入符合css规范的样式...">'+j+"</textarea>"+'脚本: <textarea required class="form-control rule-script" style="min-height: 100px" placeholder="输入合法的脚本(可选)...">'+i+"</textarea>",buttons:[{label:"取消",action:function(m){m.close()}},{label:"确定",cssClass:"btn-primary",action:function(m){var r=$.trim(m.getModalBody().find(".rule-title").val());var o=$.trim(m.getModalBody().find(".rule-url").val());var p=$.trim(m.getModalBody().find(".rule-css").val()).replace(/<[^>].*?>/g,"");var n=$.trim(m.getModalBody().find(".rule-script").val());var q=new RegExp("[a-zA-z]+://[^s]*","i");if(r==""||o==""||p==""){alert("有选项未填写!")}else{if(r.length>30){alert("标题长度不可以超过20个字!")}else{if(!o.match(q)){alert("url链接不合法!")}else{if(o.length>150){alert("链接长度不可以超过50!")}else{chrome.storage.sync.get(o,function(s){var t={};t[o]={"css":p,"title":r,"script":n};if(_.size(s).length>0){if(confirm("该链接已存在响应样式，确认要覆盖吗？")){chrome.storage.sync.set(t);f(r,o,p,n,g);m.close()}}else{chrome.storage.sync.set(t);f(r,o,p,n,g);m.close()}})}}}}}}]})})})});